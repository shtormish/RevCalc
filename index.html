<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Fix for icons on GitHub Pages: Set Content Security Policy to allow images from shields.io -->
    <meta http-equiv="Content-Security-Policy" content="img-src 'self' data: https://img.shields.io;">
    <!-- Add a simple emoji-based favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>📈</text></svg>">
    <title>Investment Calculator</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #f8fafc;
            --text: #0f172a;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --grid-line-color: #cbd5e1;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --milestone-double: #34d399;
            --milestone-tenfold: #fbbf24;
            --milestone-hundredfold: #ef4444;
            --inflation-loss: #ef4444;
            --milestone-target: #60a5fa;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            padding: 15px 20px;
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow);
        }

        .header__title {
            font-size: 1.75rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header__actions {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .header__badges {
            display: flex;
            gap: 10px;
        }

        .header__button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            box-shadow: var(--shadow);
        }

        .header__button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px) scale(1.02);
            box-shadow: var(--shadow-lg);
        }

        .header__button:active {
            transform: translateY(0) scale(0.98);
            box-shadow: var(--shadow);
        }

        .header__button--icon {
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .has-tooltip {
            position: relative;
        }

        /* Tooltip styles */
        .has-tooltip::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease-in-out;
            z-index: 10;
            background: var(--text);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            white-space: nowrap;
            margin-bottom: 8px;
        }

        .has-tooltip:hover::before {
            opacity: 1;
        }

        .header__button--icon svg {
            stroke: white;
            width: 20px;
            height: 20px;
        }

        /* Dark Theme */
        body.dark-theme {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --secondary: #1f2937;
            --text: #f9fafb;
            --text-secondary: #9ca3af;
            --inflation-loss: #ef4444;
            --border: #374151;
            --grid-line-color: #4b5563;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.4), 0 2px 4px -2px rgb(0 0 0 / 0.3);

            background: linear-gradient(135deg, #111827 0%, #1f2937 100%);
        }

        body.dark-theme .header,
        body.dark-theme .input-section,
        body.dark-theme .results-section,
        body.dark-theme .milestones-section,
        body.dark-theme .chart-section,
        body.dark-theme .plan-section {
            background: var(--secondary);
        }

        body.dark-theme .header__title {
            background: linear-gradient(135deg, var(--primary) 0%, #60a5fa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        body.dark-theme .has-tooltip::before {
            color: #1f2937;
        }

        body.dark-theme .input-group__field {
            background: #374151;
            color: var(--text);
            border-color: var(--border);
        }

        body.dark-theme .milestone-card,
        body.dark-theme .plan-table__row:hover,
        body.dark-theme .plan-table__header {
            background: linear-gradient(135deg, #374151 0%, #1f2937 100%);
        }

        .calculator {
            display: grid;
            grid-template-columns: 1fr;
            gap: 6px;
            margin-bottom: 6px;
        }

        .input-section, .results-section {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .section__title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px 20px;
        }

        .input-group { /* This can remain as a block itself */
            margin-bottom: 0;
        }

        .input-group__label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .input-group__hint {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 4px;
            line-height: 1.4;
        }

        .input-wrapper {
            position: relative;
            width: 100%;
        }

        .validation-tooltip {
            position: absolute;
            bottom: calc(100% + 5px);
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.2s ease-in-out, visibility 0.2s ease-in-out;
            z-index: 10;
            background: var(--text);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            white-space: nowrap;
        }

        .input-wrapper:hover .validation-tooltip,
        .input-wrapper:focus-within .validation-tooltip {
            opacity: 1;
            visibility: visible;
        }

        .input-group__field {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.2s ease-in-out;
            background: var(--secondary);
        }

        .input-group__field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .input-group__row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .result-card {
            background: var(--secondary);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            transition: transform 0.2s ease-in-out;
            min-height: 100px;
        }

        .result-card:hover {
            transform: translateY(-2px);
        }

        .result-card__value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
            margin: 8px 0;
        }

        .result-card__label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.3;
        }

        .result-card__hint {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-top: 4px;
            line-height: 1.2;
        }

        .milestones-section {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 6px;
            box-shadow: var(--shadow);
        }

        .milestones-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .milestone-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid transparent;
        }

        .milestone-card--double { border-left-color: var(--milestone-double); }
        .milestone-card--double .milestone-card__title { color: var(--milestone-double); }

        .milestone-card--tenfold { border-left-color: var(--milestone-tenfold); }
        .milestone-card--tenfold .milestone-card__title { color: var(--milestone-tenfold); }

        .milestone-card--hundredfold { border-left-color: var(--milestone-hundredfold); }
        .milestone-card--hundredfold .milestone-card__title { color: var(--milestone-hundredfold); }

        .milestone-card--target { border-left-color: var(--milestone-target); }
        .milestone-card--target .milestone-card__title { color: var(--milestone-target); }

        .milestone-card__title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .milestone-card__value {
            font-size: 1.2rem;
            font-weight: 700;
        }
        
        .chart-section {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 6px;
        }

        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chart-container svg {
            width: 100%;
            height: 100%;
        }

        .chart-line {
            fill: none;
            stroke: var(--primary);
            stroke-width: 3;
            stroke-linecap: round;
            stroke-linejoin: round;
            transition: stroke-dashoffset 1s ease-in-out;
        }

        .chart-fill {
            fill: url(#chartGradient);
            stroke: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out 0.5s;
        }

        .chart-fill-inflation {
            fill: var(--inflation-loss);
            stroke: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out 0.5s;
        }

        .grid-line, .axis-line {
            stroke: var(--grid-line-color);
            stroke-dasharray: 2, 3;
        }

        .axis-label {
            font-size: 0.75rem;
            fill: var(--text-secondary);
        }

        .milestone-line {
            stroke-width: 1.5;
            stroke-dasharray: 4, 4;
            pointer-events: none;
        }

        .milestone-label {
            font-size: 0.7rem;
            font-weight: 600;
            text-anchor: middle;
            pointer-events: none;
        }

        .chart-tooltip {
            position: absolute;
            display: none;
            padding: 8px 12px;
            background: var(--text);
            color: white;
            border-radius: 8px;
            font-size: 0.85rem;
            pointer-events: none; /* So it doesn't interfere with mouse events */
            transform: translate(-50%, -120%); /* Position above cursor */
            transition: opacity 0.1s ease-in-out;
            white-space: nowrap;
            z-index: 10;
        }

        .chart-indicator-line {
            stroke: var(--primary);
            stroke-width: 1;
            stroke-dasharray: 3, 3;
            pointer-events: none;
        }

        .chart-indicator-point {
            fill: var(--primary);
            stroke: white;
            stroke-width: 2px;
            pointer-events: none;
        }

        body.dark-theme .chart-tooltip {
            background: #f9fafb;
            color: #1f2937;
        }

        body.dark-theme .chart-indicator-point {
            stroke: var(--secondary);
        }

        body.dark-theme .validation-tooltip {
            background: #f9fafb;
            color: #1f2937;
        }

        .plan-section {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .plan-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .plan-table__header {
            background: var(--secondary);
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--border);
        }

        .plan-table__cell {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }

        .plan-table__row:hover {
            background: var(--secondary);
        }

        .plan-table__cell--cumulative {
            font-weight: 600;
        }

        .plan-table__cell--positive {
            color: var(--success);
        }

        .plan-table__cell--negative {
            color: var(--danger);
        }

        .plan-table__cell, .plan-table__header {
            transition: padding 0.2s ease-in-out;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .header {
                flex-wrap: wrap;
                justify-content: center;
                gap: 15px;
                text-align: center;
            }

            .header__title {
                width: 100%;
                text-align: center;
            }

            .header__actions {
                justify-content: center;
            }

            .input-group__row {
                grid-template-columns: 1fr;
            }

            .input-grid {
                grid-template-columns: 1fr;
                gap: 0;
            }

            .input-group {
                margin-bottom: 15px;
            }

            .results-grid {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }

            .milestones-grid {
                grid-template-columns: 1fr;
            }
            
            .result-card {
                padding: 12px;
                min-height: 90px;
            }
            
            .result-card__value {
                font-size: 1.1rem;
                margin: 6px 0;
            }

            .plan-table__cell, .plan-table__header {
                padding-left: 8px;
                padding-right: 8px;
            }
        }

        @media (max-width: 480px) {
            .results-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            body {
                padding: 10px;
            }

            .input-section, .results-section, .milestones-section, .plan-section {
                padding: 20px 15px;
            }
            
            .result-card {
                padding: 10px;
                min-height: 80px;
            }
            
            .result-card__value {
                font-size: 1rem;
            }

            .plan-table__cell, .plan-table__header {
                padding-left: 4px;
                padding-right: 4px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="header__title" id="title">Investment Calculator</h1>
            <div class="header__actions">
                <div class="header__badges">
                    <a href="https://github.com/shtormish/RevCalc/" target="_blank" rel="noopener noreferrer">
                        <img src="https://img.shields.io/github/stars/shtormish/RevCalc?style=social" alt="GitHub Stars">
                    </a>
                    <a href="https://github.com/shtormish/RevCalc/blob/main/LICENSE" target="_blank" rel="noopener noreferrer">
                        <img src="https://img.shields.io/badge/License-MIT-blue" alt="License: MIT">
                    </a>
                </div>
                <button class="header__button header__button--icon has-tooltip" id="resetButton" data-tooltip="Reset">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M21 21v-5h-5"/></svg>
                </button>
                <button class="header__button header__button--icon has-tooltip" id="themeToggleButton" data-tooltip="Dark Mode">
                    <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                    <svg class="icon-sun" style="display: none;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                </button>
                <button class="header__button header__button--icon has-tooltip" id="shareButton" data-tooltip="Share Scenario">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
                </button>
                <button class="header__button has-tooltip" id="languageToggle" data-tooltip="Switch Language">RU</button>
            </div>
        </div>

        <div class="calculator">
            <div class="input-section">
                <h2 class="section__title">Input Parameters</h2>
                <div class="input-grid">
                    <div class="input-group">
                        <label class="input-group__label" id="initialAmountLabel">Initial Investment Amount</label>
                        <div class="input-wrapper">
                            <input type="number" class="input-group__field" id="initialAmount" value="10000" min="0">
                            <div class="validation-tooltip" id="initialAmountValidationTooltip"></div>
                        </div>
                        <div class="input-group__hint" id="initialAmountHint">The starting amount of your investment. This is the base amount that will earn interest over time.</div>
                    </div>

                    <div class="input-group">
                        <label class="input-group__label" id="interestRateCompoundingLabel">Interest Rate & Compounding</label>
                        <div class="input-group__row">
                            <div class="input-wrapper">
                                <input type="number" class="input-group__field" id="interestRate" value="8" step="0.1">
                                <div class="validation-tooltip" id="interestRateValidationTooltip"></div>
                            </div>
                            <select class="input-group__field" id="compounding">
                                <option value="0">No Compounding</option>
                                <option value="1">Daily</option>
                                <option value="30">Monthly</option>
                                <option value="90">Quarterly</option>
                                <option value="180">Semi-Annually</option>
                                <option value="365" selected>Annually</option>
                            </select>
                        </div>
                        <div class="input-group__hint" id="interestRateCompoundingHint">The annual rate and how often interest is added. More frequent compounding leads to higher returns.</div>
                    </div>

                    <div class="input-group">
                        <label class="input-group__label" id="investmentTermLabel">Investment Term</label>
                        <div class="input-group__row">
                            <div class="input-wrapper">
                                <input type="number" class="input-group__field" id="investmentTerm" value="10" min="0">
                                <div class="validation-tooltip" id="investmentTermValidationTooltip"></div>
                            </div>
                            <select class="input-group__field" id="termUnit">
                                <option value="1">Days</option>
                                <option value="30">Months</option>
                                <option value="365" selected>Years</option>
                            </select>
                        </div>
                        <div class="input-group__hint" id="investmentTermHint">The duration of your investment. Longer terms generally lead to higher returns due to compounding.</div>
                    </div>

                    <div class="input-group">
                        <label class="input-group__label" id="additionalInvestmentLabel">Additional Investment</label>
                        <div class="input-group__row">
                            <div class="input-wrapper">
                                <input type="number" class="input-group__field" id="additionalAmount" value="0" min="0">
                                <div class="validation-tooltip" id="additionalAmountValidationTooltip"></div>
                            </div>
                            <select class="input-group__field" id="additionalFrequency">
                                <option value="0">No Additional</option>
                                <option value="1">Daily</option>
                                <option value="30" selected>Monthly</option>
                                <option value="90">Quarterly</option>
                                <option value="365">Annually</option>
                            </select>
                        </div>
                        <div class="input-group__hint" id="additionalInvestmentHint">Regular additional investments can significantly boost your final amount through dollar-cost averaging.</div>
                    </div>

                    <div class="input-group">
                        <label class="input-group__label" id="targetMonthlyIncomeLabel">Target Monthly Income (X)</label>
                        <div class="input-wrapper">
                            <input type="number" class="input-group__field" id="targetMonthlyIncome" value="1000" min="0">
                            <div class="validation-tooltip" id="targetMonthlyIncomeValidationTooltip"></div>
                        </div>
                        <div class="input-group__hint" id="targetMonthlyIncomeHint">The monthly income you want to achieve from your investment. This helps plan for financial goals.</div>
                    </div>

                    <div class="input-group">
                        <label class="input-group__label" id="inflationRateLabel">Expected Annual Inflation (%)</label>
                        <div class="input-wrapper">
                            <input type="number" class="input-group__field" id="inflationRate" value="0" step="0.1">
                            <div class="validation-tooltip" id="inflationRateValidationTooltip"></div>
                        </div>
                        <div class="input-group__hint" id="inflationRateHint">The rate at which money loses its value. This helps calculate the real return on your investment.</div>
                    </div>
                </div>
            </div>

            <div class="results-section">
                <h2 class="section__title">Calculated Results</h2>
                <div class="results-grid">
                    <div class="result-card">
                        <div class="result-card__label" id="finalAmountLabel">Final Amount</div>
                        <div class="result-card__value" id="finalAmountValue">0</div>
                        <div class="result-card__hint" id="finalAmountHint">Total amount at the end of investment period including all profits</div>
                    </div>
                    <div class="result-card">
                        <div class="result-card__label" id="totalProfitLabel">Total Profit</div>
                        <div class="result-card__value" id="totalProfitValue">0</div>
                        <div class="result-card__hint" id="totalProfitHint">Absolute profit and percentage gain over the entire period</div>
                    </div>
                    <div class="result-card">
                        <div class="result-card__label" id="effectiveRateLabel">Effective Rate</div>
                        <div class="result-card__value" id="effectiveRateValue">0%</div>
                        <div class="result-card__hint" id="effectiveRateHint">Actual annualized return considering compounding effect</div>
                    </div>
                    <div class="result-card">
                        <div class="result-card__label" id="theoreticalMonthlyIncomeLabel">Theoretical Monthly Income</div>
                        <div class="result-card__value" id="theoreticalMonthlyIncomeValue">0</div>
                        <div class="result-card__hint" id="theoreticalMonthlyIncomeHint">Monthly income if withdrawing interest from final amount</div>
                    </div>
                    <div class="result-card">
                        <div class="result-card__label" id="averageMonthlyProfitLabel">Avg Monthly Profit</div>
                        <div class="result-card__value" id="averageMonthlyProfitValue">0</div>
                        <div class="result-card__hint" id="averageMonthlyProfitHint">Average monthly capital growth during investment period</div>
                    </div>
                    <div class="result-card">
                        <div class="result-card__label" id="averageAnnualProfitLabel">Avg Annual Profit</div>
                        <div class="result-card__value" id="averageAnnualProfitValue">0</div>
                        <div class="result-card__hint" id="averageAnnualProfitHint">Average annual capital growth during investment period</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="milestones-section">
            <h2 class="section__title">Key Milestones</h2>
            <div class="milestones-grid">
                <div class="milestone-card milestone-card--double">
                    <div class="milestone-card__title" id="doubleLabel">Double Investment</div>
                    <div class="milestone-card__value" id="doubleValue">0 years</div>
                </div>
                <div class="milestone-card milestone-card--tenfold">
                    <div class="milestone-card__title" id="tenfoldLabel">Tenfold Investment</div>
                    <div class="milestone-card__value" id="tenfoldValue">0 years</div>
                </div>
                <div class="milestone-card milestone-card--hundredfold">
                    <div class="milestone-card__title" id="hundredfoldLabel">Hundredfold Investment</div>
                    <div class="milestone-card__value" id="hundredfoldValue">0 years</div>
                </div>
                <div class="milestone-card milestone-card--target">
                    <div class="milestone-card__title" id="targetIncomeLabel">Target Monthly Income</div>
                    <div class="milestone-card__value" id="targetIncomeValue">0 years</div>
                </div>
            </div>
        </div>

        <div class="chart-section">
            <h2 class="section__title" id="chartTitle">Investment Growth Chart</h2>
            <div class="chart-container" id="chartContainer">
                <!-- SVG chart is injected here by JavaScript -->
            </div>
        </div>

        <div class="plan-section">
            <h2 class="section__title">Monthly Income Plan</h2>
            <div>
                <table class="plan-table">
                    <thead>
                        <tr class="plan-table__row">
                            <th class="plan-table__header" id="monthLabel">Month</th>
                            <th class="plan-table__header" id="cumulativeAmountLabel">Cumulative Amount</th>
                            <th class="plan-table__header" id="monthlyIncomeLabel">Monthly Income</th>
                            <th class="plan-table__header" id="monthlyPercentageLabel">% of Initial</th>
                        </tr>
                    </thead>
                    <tbody id="planTableBody">
                        <!-- Generated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Format number with K/M suffixes for brevity.
        function formatNumber(num) {
            if (Math.abs(num) > 999999) {
                return (num / 1000000).toFixed(2) + 'M';
            }
            if (Math.abs(num) > 999) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toFixed(2);
        }

        // Format a period of days into a human-readable string (e.g., "1 year 2 months 3 days").
        // This version includes improved pluralization for both English and Russian.
        function formatTimePeriod(days, lang = 'en') {
            if (!days || days <= 0) {
                return lang === 'en' ? 'Never' : 'Никогда';
            }

            const years = Math.floor(days / 365);
            const months = Math.floor((days % 365) / 30);
            const remainingDays = Math.round(days - (years * 365) - (months * 30));

            const parts = [];

            if (lang === 'en') {
                if (years > 0) parts.push(`${years} ${years === 1 ? 'year' : 'years'}`);
                if (months > 0) parts.push(`${months} ${months === 1 ? 'month' : 'months'}`);
                if (remainingDays > 0) parts.push(`${remainingDays} ${remainingDays === 1 ? 'day' : 'days'}`);
            } else { // ru
                const pluralize = (count, forms) => { // [one, few, many] e.g. ['год', 'года', 'лет']
                    const n = Math.abs(count) % 100;
                    const n1 = n % 10;
                    if (n > 10 && n < 20) return forms[2];
                    if (n1 > 1 && n1 < 5) return forms[1];
                    if (n1 === 1) return forms[0];
                    return forms[2];
                };
                if (years > 0) parts.push(`${years} ${pluralize(years, ['год', 'года', 'лет'])}`);
                if (months > 0) parts.push(`${months} ${pluralize(months, ['месяц', 'месяца', 'месяцев'])}`);
                if (remainingDays > 0) parts.push(`${remainingDays} ${pluralize(remainingDays, ['день', 'дня', 'дней'])}`);
            }

            return parts.length > 0 ? parts.join(' ') : (lang === 'en' ? '0 days' : '0 дней');
        }

        // Calculate compound interest using a daily simulation model.
        function calculateCompoundInterest(principal, rate, compoundingDays, termDays, additionalAmount, additionalFrequency) {
            const annualRate = rate / 100;

            // No compounding - simple interest
            if (compoundingDays === 0) {
                const simpleInterest = principal * annualRate * (termDays / 365);
                let amount = principal + simpleInterest;

                if (additionalFrequency > 0 && additionalAmount > 0) {
                    const numberOfAdditionalInvestments = Math.floor(termDays / additionalFrequency);
                    amount += additionalAmount * numberOfAdditionalInvestments;
                }
                return amount;
            }

            // With compounding
            let amount = principal;
            const dailyRate = annualRate / 365;

            for (let day = 1; day <= termDays; day++) {
                if (additionalFrequency > 0 && day % additionalFrequency === 0) {
                    amount += additionalAmount;
                }
                if (day % compoundingDays === 0) {
                    const periodRate = dailyRate * compoundingDays;
                    amount *= (1 + periodRate);
                }
            }
            return amount;
        }

        // Calculate a month-by-month breakdown of the investment growth.
        function calculateMonthlyPlan(principal, rate, compoundingDays, termDays, additionalAmount, additionalFrequency) {
            const annualRate = rate / 100;
            const dailyRate = annualRate / 365;
            let amount = principal;
            const monthlyData = [];
            let previousMonthAmount = principal;

            for (let month = 1; month <= Math.ceil(termDays / 30); month++) {
                const startDay = (month - 1) * 30 + 1;
                const endDay = Math.min(month * 30, termDays);

                for (let day = startDay; day <= endDay; day++) {
                    if (additionalFrequency > 0 && day % additionalFrequency === 0) {
                        amount += additionalAmount;
                    }
                    if (compoundingDays > 0 && day % compoundingDays === 0) {
                        const periodRate = dailyRate * compoundingDays;
                        amount *= (1 + periodRate);
                    }
                }

                const monthlyIncome = amount - previousMonthAmount;
                monthlyData.push({
                    month: month,
                    cumulativeAmount: amount,
                    monthlyIncome: monthlyIncome,
                    percentageOfInitial: principal > 0 ? (monthlyIncome / principal) * 100 : 0
                });
                previousMonthAmount = amount;
            }
            return monthlyData;
        }

        // Calculate the effective annual rate (CAGR).
        function calculateEffectiveRate(principal, finalAmount, termDays) {
            if (termDays <= 0 || principal <= 0 || finalAmount <= principal) return 0;
            const totalGrowthFactor = finalAmount / principal;
            const effectiveRate = (Math.pow(totalGrowthFactor, 365 / termDays) - 1) * 100;
            return effectiveRate;
        }

        // Calculate average monthly and annual profits.
        function calculateAverageProfits(principal, finalAmount, termDays) {
            if (termDays <= 0) return { monthly: 0, annual: 0, monthlyPercent: 0, annualPercent: 0 };

            const totalProfit = finalAmount - principal;
            const years = termDays / 365;
            const months = years * 12;

            const averageMonthlyProfit = months > 0 ? totalProfit / months : 0;
            const averageAnnualProfit = years > 0 ? totalProfit / years : 0;
            const averageMonthlyPercent = principal > 0 && months > 0 ? (totalProfit / principal) * 100 / months : 0;
            const averageAnnualPercent = principal > 0 && years > 0 ? (totalProfit / principal) * 100 / years : 0;

            return {
                monthly: averageMonthlyProfit,
                annual: averageAnnualProfit,
                monthlyPercent: averageMonthlyPercent,
                annualPercent: averageAnnualPercent
            };
        }

        // Calculate key investment milestones.
        function calculateMilestones(principal, rate, compoundingDays, additionalAmount, additionalFrequency, targetIncome) {
            const annualRate = rate / 100;
            const dailyRate = annualRate / 365;
            let amount = principal;
            let daysToDouble = 0, daysToTenfold = 0, daysToHundredfold = 0, daysToTargetIncome = 0;

            // Limit search to 100 years to prevent infinite loops
            for (let day = 1; day <= 365 * 100; day++) {
                if (additionalFrequency > 0 && day % additionalFrequency === 0) amount += additionalAmount;

                if (compoundingDays > 0 && day % compoundingDays === 0) {
                    amount *= (1 + dailyRate * compoundingDays);
                } else if (compoundingDays === 0) {
                    amount += principal * dailyRate; // Simple interest
                }

                if (daysToDouble === 0 && principal > 0 && amount >= principal * 2) daysToDouble = day;
                if (daysToTenfold === 0 && principal > 0 && amount >= principal * 10) daysToTenfold = day;
                if (daysToHundredfold === 0 && principal > 0 && amount >= principal * 100) daysToHundredfold = day;
                if (daysToTargetIncome === 0 && targetIncome > 0 && (amount * annualRate / 12) >= targetIncome) daysToTargetIncome = day;

                if (daysToDouble && daysToTenfold && daysToHundredfold && (daysToTargetIncome || targetIncome <= 0)) break;
            }

            return { double: daysToDouble, tenfold: daysToTenfold, hundredfold: daysToHundredfold, targetIncome: daysToTargetIncome };
        }

        // Generate data points for the chart with a daily simulation model.
        function generateChartData(principal, rate, compoundingDays, termDays, additionalAmount, additionalFrequency, inflationRate) {
            if (termDays < 1) return [];

            const annualRate = rate / 100;
            const annualInflationRate = (inflationRate || 0) / 100;
            const dailyRate = annualRate / 365;
            const dataPoints = [{ day: 0, amount: principal, realAmount: principal }];
            let amount = principal;

            // Use a step to keep the number of points reasonable for performance
            const maxPoints = 200;
            const step = Math.max(1, Math.floor(termDays / maxPoints));

            for (let day = 1; day <= termDays; day++) {
                if (additionalFrequency > 0 && day % additionalFrequency === 0) amount += additionalAmount;

                if (compoundingDays > 0 && day % compoundingDays === 0) {
                    amount *= (1 + dailyRate * compoundingDays);
                } else if (compoundingDays === 0) {
                    amount += principal * dailyRate; // Simple interest simulation
                }

                if (day % step === 0 || day === termDays) {
                    const realAmount = amount / Math.pow(1 + annualInflationRate, day / 365);
                    dataPoints.push({ day: day, amount: amount, realAmount: realAmount });
                }
            }
            return dataPoints;
        }

        // Translation dictionaries
        const translations = {
            en: {
                title: "Investment Calculator",
                inputParameters: "Input Parameters",
                initialAmount: "Initial Investment Amount",
                initialAmountHint: "The starting amount of your investment. This is the base amount that will earn interest over time.",
                interestRateCompounding: "Interest Rate & Compounding",
                interestRateCompoundingHint: "The annual rate and how often interest is added. More frequent compounding leads to higher returns.",
                investmentTerm: "Investment Term",
                investmentTermHint: "The duration of your investment. Longer terms generally lead to higher returns due to compounding.",
                additionalInvestment: "Additional Investment",
                additionalInvestmentHint: "Regular additional investments can significantly boost your final amount through dollar-cost averaging.",
                targetMonthlyIncome: "Target Monthly Income (X)",
                targetMonthlyIncomeHint: "The monthly income you want to achieve from your investment. This helps plan for financial goals.",
                calculatedResults: "Calculated Results",
                inflationRate: "Expected Annual Inflation (%)",
                inflationRateHint: "The rate at which money loses its value. This helps calculate the real return on your investment.",
                finalAmount: "Final Amount",
                finalAmountHint: "Total amount at the end of investment period including all profits",
                totalProfit: "Total Profit",
                totalProfitHint: "Absolute profit and percentage gain over the entire period",
                effectiveRate: "Effective Rate",
                effectiveRateHint: "Actual annualized return considering compounding effect",
                theoreticalMonthlyIncome: "Theoretical Monthly Income",
                theoreticalMonthlyIncomeHint: "Monthly income if withdrawing interest from final amount",
                averageMonthlyProfit: "Avg Monthly Profit",
                averageMonthlyProfitHint: "Average monthly capital growth during investment period",
                averageAnnualProfit: "Avg Annual Profit",
                averageAnnualProfitHint: "Average annual capital growth during investment period",
                keyMilestones: "Key Milestones",
                doubleInvestment: "Double Investment",
                tenfoldInvestment: "Tenfold Investment",
                hundredfoldInvestment: "Hundredfold Investment",
                targetMonthlyIncomeMilestone: "Target Monthly Income",
                monthlyIncomePlan: "Monthly Income Plan",
                doubleShort: "2x",
                tenfoldShort: "10x",
                hundredfoldShort: "100x",
                targetShort: "Target",
                chartTitle: "Investment Growth Chart",
                month: "Month",
                cumulativeAmount: "Cumulative Amount",
                monthlyIncome: "Monthly Income",
                monthlyPercentage: "% of Initial",
                noCompounding: "No Compounding",
                daily: "Daily",
                monthly: "Monthly",
                quarterly: "Quarterly",
                semiAnnually: "Semi-Annually",
                annually: "Annually",
                days: "Days",
                months: "Months",
                years: "Years",
                noAdditional: "No Additional",
                double: "Double",
                tenfold: "Tenfold",
                hundredfold: "Hundredfold",
                resetTooltip: "Reset Form",
                darkMode: "Dark Mode",
                lightMode: "Light Mode",
                languageTooltip: "Switch to English",
                shareTooltip: "Share Scenario",
                copiedTooltip: "Copied!",
                nominalAmount: "Nominal",
                realAmount: "Real",
                initialAmount_tt: "Value must be ≥ 0",
                interestRate_tt: "Can be any value, including negative",
                investmentTerm_tt: "Value must be ≥ 0",
                additionalAmount_tt: "Value must be ≥ 0",
                targetMonthlyIncome_tt: "Value must be ≥ 0",
                inflationRate_tt: "Can be any value, including negative"
            },
            ru: {
                title: "Калькулятор Инвеcтиций",
                inputParameters: "Входные Параметры",
                initialAmount: "Начальная cумма Инвеcтиций",
                initialAmountHint: "Стартовая cумма вашего вложения. Это базовая cумма, которая будет приноcить проценты co временем.",
                interestRateCompounding: "Процентная ставка и Капитализация",
                interestRateCompoundingHint: "Годовая ставка и как часто начисляются проценты. Более частая капитализация ведет к большей доходности.",
                investmentTerm: "Срок Инвеcтиций",
                investmentTermHint: "Продолжительноcть вашего вложения. Более длительные cроки обычно приводят к более выcокой доходноcти благодаря капитализации.",
                additionalInvestment: "Дополнительные Вложения",
                additionalInvestmentHint: "Регулярные дополнительные вложения могут значительно увеличить вашу конечную cумму благодаря уcреднению cтоимоcти.",
                targetMonthlyIncome: "Целевой Меcячный Доход (X)",
                targetMonthlyIncomeHint: "Меcячный доход, который вы хотите получить от инвеcтиций. Это помогает планировать финанcовые цели.",
                calculatedResults: "Вычиcляемые Параметры",
                inflationRate: "Ожидаемая годовая инфляция (%)",
                inflationRateHint: "Cкороcть, c которой деньги теряют cвою cтоимоcть. Это помогает раccчитать реальную доходноcть ваших инвеcтиций.",
                finalAmount: "Конечная cумма",
                finalAmountHint: "Общая cумма в конце периода инвестиций, включая вcю прибыль",
                totalProfit: "Полный Доход",
                totalProfitHint: "Абcолютная прибыль и процентный доход за веcь период",
                effectiveRate: "Эффективная cтавка",
                effectiveRateHint: "Фактичеcкая годовая доходноcть c учетом эффекта капитализации",
                theoreticalMonthlyIncome: "Теоретичеcкий Меcячный Доход",
                theoreticalMonthlyIncomeHint: "Меcячный доход при cнятии процентов c финальной cуммы",
                averageMonthlyProfit: "Средний Меcячный Прироcт",
                averageMonthlyProfitHint: "Среднемеcячный роcт капитала за период инвеcтиций",
                averageAnnualProfit: "Средний Годовой Прироcт",
                averageAnnualProfitHint: "Среднегодовой роcт капитала за период инвеcтиций",
                keyMilestones: "Ключевые Вехи",
                doubleInvestment: "Удвоение Вклада",
                tenfoldInvestment: "Удеcятерение Вклада",
                hundredfoldInvestment: "Увеличение в 100 раз",
                targetMonthlyIncomeMilestone: "Целевой Меcячный Доход",
                monthlyIncomePlan: "Помеcячный План Дохода",
                doubleShort: "2x",
                tenfoldShort: "10x",
                hundredfoldShort: "100x",
                targetShort: "Цель",
                chartTitle: "График Роcта Инвеcтиций",
                month: "Меcяц",
                cumulativeAmount: "Накопленная cумма",
                monthlyIncome: "Меcячный Доход",
                monthlyPercentage: "% от Начальной",
                noCompounding: "Без Капитализации",
                daily: "Ежедневно",
                monthly: "Ежемеcячно",
                quarterly: "Ежеквартально",
                semiAnnually: "Полугодовой",
                annually: "Ежегодно",
                days: "Дни",
                months: "Меcяцы",
                years: "Годы",
                noAdditional: "Без Дополнительных",
                double: "Удвоение",
                tenfold: "Удеcятерение",
                hundredfold: "Увеличение в 100 раз",
                resetTooltip: "Сбросить форму",
                darkMode: "Тёмный режим",
                lightMode: "Светлый режим",
                languageTooltip: "Переключить на русский",
                shareTooltip: "Поделиться сценарием",
                copiedTooltip: "Скопировано!",
                nominalAmount: "Номинал",
                realAmount: "Реальная",
                initialAmount_tt: "Значение должно быть ≥ 0",
                interestRate_tt: "Может быть любым, включая отрицательное",
                investmentTerm_tt: "Значение должно быть ≥ 0",
                additionalAmount_tt: "Значение должно быть ≥ 0",
                targetMonthlyIncome_tt: "Значение должно быть ≥ 0",
                inflationRate_tt: "Может быть любым, включая отрицательное"
            }
        };

        let currentLanguage = 'en';

        // DOM Elements
        const elements = {
            languageToggle: document.getElementById('languageToggle'),
            initialAmount: document.getElementById('initialAmount'),
            interestRate: document.getElementById('interestRate'),
            compounding: document.getElementById('compounding'),
            investmentTerm: document.getElementById('investmentTerm'),
            termUnit: document.getElementById('termUnit'),
            additionalAmount: document.getElementById('additionalAmount'),
            additionalFrequency: document.getElementById('additionalFrequency'),
            targetMonthlyIncome: document.getElementById('targetMonthlyIncome'),
            inflationRate: document.getElementById('inflationRate'),
            finalAmountValue: document.getElementById('finalAmountValue'),
            totalProfitValue: document.getElementById('totalProfitValue'),
            effectiveRateValue: document.getElementById('effectiveRateValue'),
            theoreticalMonthlyIncomeValue: document.getElementById('theoreticalMonthlyIncomeValue'),
            averageMonthlyProfitValue: document.getElementById('averageMonthlyProfitValue'),
            averageAnnualProfitValue: document.getElementById('averageAnnualProfitValue'),
            doubleValue: document.getElementById('doubleValue'),
            tenfoldValue: document.getElementById('tenfoldValue'),
            hundredfoldValue: document.getElementById('hundredfoldValue'),
            targetIncomeValue: document.getElementById('targetIncomeValue'),
            planTableBody: document.getElementById('planTableBody'),
            chartContainer: document.getElementById('chartContainer'),
            resetButton: document.getElementById('resetButton'),
            themeToggleButton: document.getElementById('themeToggleButton'),
            shareButton: document.getElementById('shareButton')
        };

        // Translation elements mapping
        const translationElements = {
            title: document.getElementById('title'),
            inputParameters: document.querySelector('.input-section .section-title'),
            initialAmountLabel: document.getElementById('initialAmountLabel'),
            initialAmountHint: document.getElementById('initialAmountHint'),
            interestRateCompoundingLabel: document.getElementById('interestRateCompoundingLabel'),
            interestRateCompoundingHint: document.getElementById('interestRateCompoundingHint'),
            investmentTermLabel: document.getElementById('investmentTermLabel'),
            investmentTermHint: document.getElementById('investmentTermHint'),
            additionalInvestmentLabel: document.getElementById('additionalInvestmentLabel'),
            additionalInvestmentHint: document.getElementById('additionalInvestmentHint'),
            targetMonthlyIncomeLabel: document.getElementById('targetMonthlyIncomeLabel'),
            targetMonthlyIncomeHint: document.getElementById('targetMonthlyIncomeHint'),
            inflationRateLabel: document.getElementById('inflationRateLabel'),
            inflationRateHint: document.getElementById('inflationRateHint'),
            calculatedResults: document.querySelector('.results-section .section-title'),
            finalAmountLabel: document.querySelector('[id="finalAmountLabel"]'),
            finalAmountHint: document.querySelector('[id="finalAmountHint"]'),
            totalProfitLabel: document.querySelector('[id="totalProfitLabel"]'),
            totalProfitHint: document.querySelector('[id="totalProfitHint"]'),
            effectiveRateLabel: document.querySelector('[id="effectiveRateLabel"]'),
            effectiveRateHint: document.querySelector('[id="effectiveRateHint"]'),
            theoreticalMonthlyIncomeLabel: document.querySelector('[id="theoreticalMonthlyIncomeLabel"]'),
            theoreticalMonthlyIncomeHint: document.querySelector('[id="theoreticalMonthlyIncomeHint"]'),
            averageMonthlyProfitLabel: document.querySelector('[id="averageMonthlyProfitLabel"]'),
            averageMonthlyProfitHint: document.querySelector('[id="averageMonthlyProfitHint"]'),
            averageAnnualProfitLabel: document.querySelector('[id="averageAnnualProfitLabel"]'),
            averageAnnualProfitHint: document.querySelector('[id="averageAnnualProfitHint"]'),
            keyMilestones: document.querySelector('.milestones-section .section-title'),
            doubleLabel: document.getElementById('doubleLabel'),
            tenfoldLabel: document.getElementById('tenfoldLabel'),
            hundredfoldLabel: document.getElementById('hundredfoldLabel'),
            targetIncomeLabel: document.getElementById('targetIncomeLabel'),
            monthlyIncomePlan: document.querySelector('.plan-section .section-title'),
            chartTitle: document.getElementById('chartTitle'),
            monthLabel: document.getElementById('monthLabel'),
            cumulativeAmountLabel: document.getElementById('cumulativeAmountLabel'),
            monthlyIncomeLabel: document.getElementById('monthlyIncomeLabel'),
            monthlyPercentageLabel: document.getElementById('monthlyPercentageLabel'),
            initialAmountValidationTooltip: document.getElementById('initialAmountValidationTooltip'),
            interestRateValidationTooltip: document.getElementById('interestRateValidationTooltip'),
            investmentTermValidationTooltip: document.getElementById('investmentTermValidationTooltip'),
            additionalAmountValidationTooltip: document.getElementById('additionalAmountValidationTooltip'),
            targetMonthlyIncomeValidationTooltip: document.getElementById('targetMonthlyIncomeValidationTooltip'),
            inflationRateValidationTooltip: document.getElementById('inflationRateValidationTooltip')
        };

        // --- LocalStorage Persistence ---
        const STORAGE_KEY = 'revCalcState';

        function saveState() {
            const state = {
                initialAmount: elements.initialAmount.value,
                interestRate: elements.interestRate.value,
                compounding: elements.compounding.value,
                investmentTerm: elements.investmentTerm.value,
                termUnit: elements.termUnit.value,
                additionalAmount: elements.additionalAmount.value,
                additionalFrequency: elements.additionalFrequency.value,
                targetMonthlyIncome: elements.targetMonthlyIncome.value,
                inflationRate: elements.inflationRate.value,
                language: currentLanguage,
                theme: document.body.classList.contains('dark-theme')
            };
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            } catch (e) {
                console.error("Error saving state to localStorage", e);
            }
        }

        function applyState(state) {
            elements.initialAmount.value = state.initialAmount || '10000';
            elements.interestRate.value = state.interestRate || '8';
            elements.compounding.value = state.compounding || '365';
            elements.investmentTerm.value = state.investmentTerm || '10';
            elements.termUnit.value = state.termUnit || '365';
            elements.additionalAmount.value = state.additionalAmount || '0';
            elements.additionalFrequency.value = state.additionalFrequency || '30';
            elements.targetMonthlyIncome.value = state.targetMonthlyIncome || '1000';
            elements.inflationRate.value = state.inflationRate || '0';
            if (state.language) currentLanguage = state.language;
            
            document.body.classList.toggle('dark-theme', state.theme);
        }

        function loadInitialState() {
            const params = new URLSearchParams(window.location.search);
            if (params.toString() !== '') {
                const stateFromUrl = {
                    initialAmount: params.get('ia'),
                    interestRate: params.get('ir'),
                    compounding: params.get('c'),
                    investmentTerm: params.get('it'),
                    termUnit: params.get('tu'),
                    additionalAmount: params.get('aa'),
                    additionalFrequency: params.get('af'),
                    targetMonthlyIncome: params.get('tmi'),
                    inflationRate: params.get('inf'),
                    language: params.get('l'),
                    theme: params.get('th') === '1'
                };
                applyState(stateFromUrl);
                window.history.replaceState({}, document.title, window.location.pathname);
            } else {
                try {
                    const savedState = localStorage.getItem(STORAGE_KEY);
                    if (savedState) applyState(JSON.parse(savedState));
                } catch (e) {
                    console.error("Error loading state from localStorage", e);
                    localStorage.removeItem(STORAGE_KEY);
                }
            }
        }

        // Initialize compounding options
        function initializeCompoundingOptions(selectedValues = {}) {
            const compoundingOptions = {
                en: [
                    { value: "0", text: "No Compounding" },
                    { value: "1", text: "Daily" },
                    { value: "30", text: "Monthly" },
                    { value: "90", text: "Quarterly" },
                    { value: "180", text: "Semi-Annually" },
                    { value: "365", text: "Annually" }
                ],
                ru: [
                    { value: "0", text: "Без Капитализации" },
                    { value: "1", text: "Ежедневно" },
                    { value: "30", text: "Ежемеcячно" },
                    { value: "90", text: "Ежеквартально" },
                    { value: "180", text: "Полугодовой" },
                    { value: "365", text: "Ежегодно" }
                ]
            };

            const termUnitOptions = {
                en: [
                    { value: "1", text: "Days" },
                    { value: "30", text: "Months" },
                    { value: "365", text: "Years" }
                ],
                ru: [
                    { value: "1", text: "Дни" },
                    { value: "30", text: "Меcяцы" },
                    { value: "365", text: "Годы" }
                ]
            };

            const additionalFrequencyOptions = {
                en: [
                    { value: "0", text: "No Additional" },
                    { value: "1", text: "Daily" },
                    { value: "30", text: "Monthly" },
                    { value: "90", text: "Quarterly" },
                    { value: "365", text: "Annually" }
                ],
                ru: [
                    { value: "0", text: "Без Дополнительных" },
                    { value: "1", text: "Ежедневно" },
                    { value: "30", text: "Ежемеcячно" },
                    { value: "90", text: "Ежеквартально" },
                    { value: "365", text: "Ежегодно" }
                ]
            };

            // Clear and populate compounding options
            elements.compounding.innerHTML = '';
            compoundingOptions[currentLanguage].forEach(option => {
                const opt = document.createElement('option');
                opt.value = option.value;
                opt.textContent = option.text;
                elements.compounding.appendChild(opt);
            });
            elements.compounding.value = selectedValues.compounding || '365';

            // Clear and populate term unit options
            elements.termUnit.innerHTML = '';
            termUnitOptions[currentLanguage].forEach(option => {
                const opt = document.createElement('option');
                opt.value = option.value;
                opt.textContent = option.text;
                elements.termUnit.appendChild(opt);
            });
            elements.termUnit.value = selectedValues.termUnit || '365';

            // Clear and populate additional frequency options
            elements.additionalFrequency.innerHTML = '';
            additionalFrequencyOptions[currentLanguage].forEach(option => {
                const opt = document.createElement('option');
                opt.value = option.value;
                opt.textContent = option.text;
                elements.additionalFrequency.appendChild(opt);
            });
            elements.additionalFrequency.value = selectedValues.additionalFrequency || '30';
        }

        // Animate a number in a result card from its current value to a new value.
        function animateResultCard(element, endValue, formatFn) {
            const duration = 400; // Animation duration in ms
            const startValue = parseFloat(element.dataset.currentValue || 0);

            // If the value is not a number, set it directly.
            if (isNaN(endValue)) {
                element.textContent = formatFn(endValue);
                element.dataset.currentValue = 0; // Reset
                return;
            }
            
            // Store the new value
            element.dataset.currentValue = endValue;

            // If start and end are the same, no animation needed
            if (startValue === endValue) {
                element.textContent = formatFn(endValue);
                return;
            }

            let startTime = null;

            function animation(currentTime) {
                if (startTime === null) startTime = currentTime;
                const elapsedTime = currentTime - startTime;
                const progress = Math.min(elapsedTime / duration, 1);
                
                const animatedValue = startValue + (endValue - startValue) * progress;
                
                element.textContent = formatFn(animatedValue);

                if (progress < 1) {
                    requestAnimationFrame(animation);
                } else {
                    element.textContent = formatFn(endValue); // Ensure final value is exact
                }
            }

            requestAnimationFrame(animation);
        }

        function updateThemeButton() {
            const isDark = document.body.classList.contains('dark-theme');
            const t = translations[currentLanguage];
            elements.themeToggleButton.dataset.tooltip = isDark ? t.lightMode : t.darkMode;
            
            elements.themeToggleButton.querySelector('.icon-moon').style.display = isDark ? 'none' : 'block';
            elements.themeToggleButton.querySelector('.icon-sun').style.display = isDark ? 'block' : 'none';
        }

        // Update calculations
        function updateCalculations() {
            const principal = parseFloat(elements.initialAmount.value) || 0;
            const rate = parseFloat(elements.interestRate.value) || 0;
            const compoundingDays = parseInt(elements.compounding.value) || 0;
            const termValue = parseFloat(elements.investmentTerm.value) || 0;
            const termUnit = parseInt(elements.termUnit.value) || 365;
            const termDays = termValue * termUnit;
            const additionalAmount = parseFloat(elements.additionalAmount.value) || 0;
            const additionalFrequency = parseInt(elements.additionalFrequency.value) || 0;
            const targetIncome = parseFloat(elements.targetMonthlyIncome.value) || 0;
            const inflationRate = parseFloat(elements.inflationRate.value) || 0;

            // Calculate final amount
            const finalAmount = calculateCompoundInterest(principal, rate, compoundingDays, termDays, additionalAmount, additionalFrequency);
            const totalProfit = finalAmount - principal;
            const totalProfitPercentage = principal > 0 ? (totalProfit / principal) * 100 : 0;

            // Calculate effective rate
            const effectiveRate = (compoundingDays > 0 && principal > 0) ? calculateEffectiveRate(principal, finalAmount, termDays) : rate;

            // Calculate theoretical monthly income (from final amount)
            const theoreticalMonthlyIncome = termDays > 0 ? (finalAmount * (rate / 100) / 12) : 0;

            // Calculate average profits
            const averageProfits = calculateAverageProfits(principal, finalAmount, termDays);

            // Update results
            animateResultCard(elements.finalAmountValue, finalAmount, (val) => formatNumber(val));
            animateResultCard(elements.totalProfitValue, totalProfit, (val) => `${formatNumber(val)} (${totalProfitPercentage.toFixed(1)}%)`);
            animateResultCard(elements.effectiveRateValue, effectiveRate, (val) => `${val.toFixed(2)}%`);
            animateResultCard(elements.theoreticalMonthlyIncomeValue, theoreticalMonthlyIncome, (val) => formatNumber(val));
            animateResultCard(elements.averageMonthlyProfitValue, averageProfits.monthly, (val) => `${formatNumber(val)} (${averageProfits.monthlyPercent.toFixed(2)}%)`);
            animateResultCard(elements.averageAnnualProfitValue, averageProfits.annual, (val) => `${formatNumber(val)} (${averageProfits.annualPercent.toFixed(2)}%)`);

            // Calculate milestones
            const milestones = calculateMilestones(principal, rate, compoundingDays, additionalAmount, additionalFrequency, targetIncome);
            elements.doubleValue.textContent = formatTimePeriod(milestones.double, currentLanguage);
            elements.tenfoldValue.textContent = formatTimePeriod(milestones.tenfold, currentLanguage);
            elements.hundredfoldValue.textContent = formatTimePeriod(milestones.hundredfold, currentLanguage);
            elements.targetIncomeValue.textContent = formatTimePeriod(milestones.targetIncome, currentLanguage);

            // Calculate monthly plan
            const monthlyPlan = calculateMonthlyPlan(principal, rate, compoundingDays, termDays, additionalAmount, additionalFrequency);
            const chartData = generateChartData(principal, rate, compoundingDays, termDays, additionalAmount, additionalFrequency, inflationRate);

            updateMonthlyPlanTable(monthlyPlan, principal);
            renderSvgChart(chartData, termDays, milestones);
            saveState();
        }
        
        // Render SVG chart for investment growth
        function renderSvgChart(chartData, termDays, milestones) {
            const container = elements.chartContainer;
            container.innerHTML = ''; // Clear previous chart

            if (!chartData || chartData.length < 2) {
                container.textContent = currentLanguage === 'ru' ? 'Недостаточно данных для графика' : 'Not enough data for a chart';
                return;
            }

            // Create tooltip element and append it to the container
            const tooltip = document.createElement('div');
            tooltip.className = 'chart-tooltip';
            container.appendChild(tooltip);

            const svgNS = "http://www.w3.org/2000/svg";
            const svg = document.createElementNS(svgNS, "svg");

            const padding = { top: 20, right: 20, bottom: 50, left: 70 };
            const width = container.clientWidth;
            const height = container.clientHeight;

            // Fallback for non-visible containers
            if (width === 0 || height === 0) return;

            svg.setAttribute('viewBox', `0 0 ${width} ${height}`);

            const chartWidth = width - padding.left - padding.right;
            const chartHeight = height - padding.top - padding.bottom;

            const amounts = chartData.map(d => d.amount);
            const minAmount = Math.min(...amounts);
            let maxAmount = Math.max(...amounts);

            // Handle edge case where min and max are the same to avoid division by zero
            if (maxAmount <= minAmount) {
                maxAmount = minAmount + 1;
            }
            const range = maxAmount - minAmount;

            // Create scales
            const xScale = (day) => padding.left + (day / termDays) * chartWidth;
            const yScale = (amount) => {
                if (range === 0) return padding.top + chartHeight / 2; // Center the line if no change
                return padding.top + chartHeight - ((amount - minAmount) / range) * chartHeight;
            };

            // --- Gradient Definition ---
            const defs = document.createElementNS(svgNS, 'defs');
            const gradient = document.createElementNS(svgNS, 'linearGradient');
            gradient.id = 'chartGradient';
            gradient.setAttribute('x1', '0%');
            gradient.setAttribute('y1', '0%');
            gradient.setAttribute('x2', '0%');
            gradient.setAttribute('y2', '100%');
            
            const stop1 = document.createElementNS(svgNS, 'stop');
            stop1.setAttribute('offset', '0%');
            stop1.setAttribute('stop-color', 'var(--primary)');
            stop1.setAttribute('stop-opacity', '0.2');
            
            const stop2 = document.createElementNS(svgNS, 'stop');
            stop2.setAttribute('offset', '100%');
            stop2.setAttribute('stop-color', 'var(--primary)');
            stop2.setAttribute('stop-opacity', '0');

            gradient.appendChild(stop1);
            gradient.appendChild(stop2);
            defs.appendChild(gradient);
            svg.appendChild(defs);

            // --- Grid Lines & Y-Axis Labels ---
            const gridGroup = document.createElementNS(svgNS, 'g');
            const yAxisTicks = 10;
            for (let i = 0; i <= yAxisTicks; i++) {
                const y = padding.top + (i / yAxisTicks) * chartHeight;
                const value = minAmount + range * (1 - i / yAxisTicks);

                const line = document.createElementNS(svgNS, 'line');
                line.setAttribute('x1', padding.left);
                line.setAttribute('y1', y);
                line.setAttribute('x2', width - padding.right);
                line.setAttribute('y2', y);
                line.setAttribute('class', 'grid-line');
                gridGroup.appendChild(line);

                const text = document.createElementNS(svgNS, 'text');
                text.setAttribute('x', padding.left - 10);
                text.setAttribute('y', y);
                text.setAttribute('dy', '0.3em');
                text.setAttribute('text-anchor', 'end');
                text.setAttribute('class', 'axis-label');
                text.textContent = formatNumber(value);
                gridGroup.appendChild(text);
            }
            svg.appendChild(gridGroup);

            // --- X-Axis Labels ---
            const xAxisGroup = document.createElementNS(svgNS, 'g');
            const numTicksX = 10;

            let unitDivisor = 1;
            let unitLabel = currentLanguage === 'ru' ? 'Дни' : 'Days';
            if (termDays > 365 * 2) {
                unitDivisor = 365;
                unitLabel = currentLanguage === 'ru' ? 'Годы' : 'Years';
            } else if (termDays > 60) {
                unitDivisor = 30;
                unitLabel = currentLanguage === 'ru' ? 'Месяцы' : 'Months';
            }

            const maxUnits = termDays / unitDivisor;

            // Calculate a "nice" integer step between ticks to avoid duplicates and decimals
            let step = Math.ceil(maxUnits / numTicksX);
            if (step > 1) {
                const powerOf10 = Math.pow(10, Math.floor(Math.log10(step)));
                const normalizedStep = step / powerOf10;
                if (normalizedStep > 5) step = 10 * powerOf10;
                else if (normalizedStep > 2) step = 5 * powerOf10;
                else if (normalizedStep > 1) step = 2 * powerOf10;
                else step = 1 * powerOf10;
            }
            step = Math.max(1, step); // Ensure step is at least 1

            for (let i = 0; ; i++) {
                 const unitValue = i * step;
                 if (unitValue > maxUnits) break;

                 const dayValue = unitValue * unitDivisor;
                 const x = xScale(dayValue);

                 // Add vertical grid line
                 const vLine = document.createElementNS(svgNS, 'line');
                 vLine.setAttribute('x1', x);
                 vLine.setAttribute('y1', padding.top);
                 vLine.setAttribute('x2', x);
                 vLine.setAttribute('y2', height - padding.bottom);
                 vLine.setAttribute('class', 'grid-line');
                 gridGroup.appendChild(vLine);

                 const text = document.createElementNS(svgNS, 'text');
                 text.setAttribute('x', x);
                 text.setAttribute('y', height - padding.bottom + 20);
                 text.setAttribute('text-anchor', 'middle');
                 text.setAttribute('class', 'axis-label');
                 text.textContent = unitValue.toString();
                 xAxisGroup.appendChild(text);
            }

            const axisTitle = document.createElementNS(svgNS, 'text');
            axisTitle.setAttribute('x', padding.left + chartWidth / 2);
            axisTitle.setAttribute('y', height - padding.bottom + 40);
            axisTitle.setAttribute('text-anchor', 'middle');
            axisTitle.setAttribute('class', 'axis-label');
            axisTitle.style.fontWeight = '600';
            axisTitle.textContent = unitLabel;
            xAxisGroup.appendChild(axisTitle);

            svg.appendChild(xAxisGroup);

            // --- Chart Path ---
            const nominalPathData = chartData.map((d, i) => {
                const x = xScale(d.day);
                const y = yScale(d.amount);
                return `${i === 0 ? 'M' : 'L'} ${x.toFixed(2)},${y.toFixed(2)}`;
            }).join(' ');

            const realPathData = chartData.map((d, i) => {
                const x = xScale(d.day);
                const y = yScale(d.realAmount);
                return `${i === 0 ? 'M' : 'L'} ${x.toFixed(2)},${y.toFixed(2)}`;
            }).join(' ');

            // --- Fill Path ---
            const realFillPathData = `${realPathData} L ${xScale(termDays).toFixed(2)},${(height - padding.bottom).toFixed(2)} L ${xScale(0).toFixed(2)},${(height - padding.bottom).toFixed(2)} Z`;
            const realFillPath = document.createElementNS(svgNS, 'path');
            realFillPath.setAttribute('d', realFillPathData);
            realFillPath.setAttribute('class', 'chart-fill');
            svg.appendChild(realFillPath);

            // --- Inflation Loss Fill Path ---
            const reversedRealPathForInflation = realPathData.substring(1).split('L').reverse().map(p => `L${p}`).join('');
            const inflationFillPathData = nominalPathData + reversedRealPathForInflation + ' Z';
            const inflationFillPath = document.createElementNS(svgNS, 'path');
            inflationFillPath.setAttribute('d', inflationFillPathData);
            inflationFillPath.setAttribute('class', 'chart-fill-inflation');
            inflationFillPath.style.opacity = '0.3';
            svg.appendChild(inflationFillPath);

            // --- Line Path ---
            const linePath = document.createElementNS(svgNS, 'path'); // This is the nominal line
            linePath.setAttribute('d', nominalPathData);
            linePath.setAttribute('class', 'chart-line');
            svg.appendChild(linePath);

            // --- Animate Chart Drawing ---
            const pathLength = linePath.getTotalLength();
            if (pathLength > 0) {
                linePath.style.strokeDasharray = pathLength;
                linePath.style.strokeDashoffset = pathLength;

                // Use a double requestAnimationFrame to ensure initial styles are applied before transitioning.
                // This is a robust way to handle animations on dynamically created elements.
                requestAnimationFrame(() => {
                    requestAnimationFrame(() => {
                        linePath.style.strokeDashoffset = '0';
                        realFillPath.style.opacity = '1';
                        inflationFillPath.style.opacity = '0.3';
                    });
                });
            } else {
                realFillPath.style.opacity = '1'; // Show fill immediately if there's no line to draw
                inflationFillPath.style.opacity = '0.3';
            }

            // --- Milestone Markers ---
            const milestoneMarkersGroup = document.createElementNS(svgNS, 'g');
            const t = translations[currentLanguage];
            const milestoneData = [
                { key: 'double', days: milestones.double, color: 'var(--milestone-double)', label: t.doubleShort },
                { key: 'tenfold', days: milestones.tenfold, color: 'var(--milestone-tenfold)', label: t.tenfoldShort },
                { key: 'hundredfold', days: milestones.hundredfold, color: 'var(--milestone-hundredfold)', label: t.hundredfoldShort },
                { key: 'targetIncome', days: milestones.targetIncome, color: 'var(--milestone-target)', label: t.targetShort }
            ];

            milestoneData.forEach(marker => {
                if (marker.days > 0 && marker.days <= termDays) {
                    const x = xScale(marker.days);

                    // Marker line
                    const line = document.createElementNS(svgNS, 'line');
                    line.setAttribute('x1', x);
                    line.setAttribute('y1', padding.top);
                    line.setAttribute('x2', x);
                    line.setAttribute('y2', height - padding.bottom);
                    line.setAttribute('class', 'milestone-line');
                    line.style.stroke = marker.color;
                    milestoneMarkersGroup.appendChild(line);

                    // Marker label
                    const text = document.createElementNS(svgNS, 'text');
                    text.setAttribute('x', x);
                    text.setAttribute('y', padding.top - 5);
                    text.setAttribute('class', 'milestone-label');
                    text.style.fill = marker.color;
                    text.textContent = marker.label;
                    milestoneMarkersGroup.appendChild(text);
                }
            });
            svg.appendChild(milestoneMarkersGroup);

            // --- Indicators and Tooltip Logic ---
            const indicatorLineY = document.createElementNS(svgNS, 'line');
            indicatorLineY.setAttribute('class', 'chart-indicator-line');
            indicatorLineY.style.display = 'none';
            svg.appendChild(indicatorLineY);

            const indicatorLineX = document.createElementNS(svgNS, 'line');
            indicatorLineX.setAttribute('class', 'chart-indicator-line');
            indicatorLineX.style.display = 'none';
            svg.appendChild(indicatorLineX);

            const indicatorPoint = document.createElementNS(svgNS, 'circle');
            indicatorPoint.setAttribute('class', 'chart-indicator-point');
            indicatorPoint.style.display = 'none';
            svg.appendChild(indicatorPoint);

            svg.addEventListener('mouseover', () => {
                tooltip.style.display = 'block';
                indicatorLineY.style.display = 'block';
                indicatorLineX.style.display = 'block';
                indicatorPoint.style.display = 'block';
            });

            svg.addEventListener('mouseout', () => {
                tooltip.style.display = 'none';
                indicatorLineY.style.display = 'none';
                indicatorLineX.style.display = 'none';
                indicatorPoint.style.display = 'none';
            });

            svg.addEventListener('mousemove', (event) => {
                const rect = svg.getBoundingClientRect();
                const mouseX = event.clientX - rect.left;

                // Convert mouse X to day value, clamped to the chart bounds
                const dayAtMouse = Math.max(0, Math.min(termDays, (mouseX - padding.left) / chartWidth * termDays));

                // Find the closest data point using reduce (efficient enough for ~200 points)
                const closestPoint = chartData.reduce((prev, curr) => {
                    return (Math.abs(curr.day - dayAtMouse) < Math.abs(prev.day - dayAtMouse) ? curr : prev);
                });

                const pointX = xScale(closestPoint.day);
                const pointY = yScale(closestPoint.amount);

                // Update indicator positions
                indicatorLineY.setAttribute('x1', pointX);
                indicatorLineY.setAttribute('y1', padding.top);
                indicatorLineY.setAttribute('x2', pointX);
                indicatorLineY.setAttribute('y2', height - padding.bottom);

                indicatorLineX.setAttribute('x1', padding.left);
                indicatorLineX.setAttribute('y1', pointY);
                indicatorLineX.setAttribute('x2', width - padding.right);
                indicatorLineX.setAttribute('y2', pointY);
                
                indicatorPoint.setAttribute('cx', pointX);
                indicatorPoint.setAttribute('cy', pointY);
                indicatorPoint.setAttribute('r', 5);

                // Update tooltip content and position
                const t = translations[currentLanguage];
                const dayLabel = t.month; // Using month label for consistency
                const nominalLabel = t.nominalAmount;
                const realLabel = t.realAmount;
                tooltip.innerHTML = `<strong>${dayLabel}:</strong> ${Math.round(closestPoint.day / 30)}<br><strong>${nominalLabel}:</strong> ${formatNumber(closestPoint.amount)}<br><strong>${realLabel}:</strong> ${formatNumber(closestPoint.realAmount)}`;
                
                tooltip.style.left = `${pointX}px`;
                tooltip.style.top = `${pointY}px`;
            });

            container.appendChild(svg);
        }

        // Update monthly plan table
        function updateMonthlyPlanTable(monthlyData, principal) {
            elements.planTableBody.innerHTML = '';
            
            monthlyData.forEach(data => {
                const row = document.createElement('tr');
                row.className = 'plan-table__row';
                row.innerHTML = `
                    <td class="plan-table__cell">${data.month}</td>
                    <td class="plan-table__cell plan-table__cell--cumulative">${formatNumber(data.cumulativeAmount)}</td>
                    <td class="plan-table__cell ${data.monthlyIncome >= 0 ? 'plan-table__cell--positive' : 'plan-table__cell--negative'}">${formatNumber(data.monthlyIncome)}</td>
                    <td class="plan-table__cell">${data.percentageOfInitial.toFixed(2)}%</td>
                `;
                elements.planTableBody.appendChild(row);
            });
        }

        // Translate UI
        function translateUI() {
            const t = translations[currentLanguage];
            
            // Store current select values before they are reset
            const selectedValues = {
                compounding: elements.compounding.value,
                termUnit: elements.termUnit.value,
                additionalFrequency: elements.additionalFrequency.value
            };

            // Update text content
            translationElements.title.textContent = t.title; // This is already a BEM element: header__title
            document.querySelector('.input-section .section__title').textContent = t.inputParameters;
            document.getElementById('initialAmountLabel').textContent = t.initialAmount;
            document.getElementById('initialAmountHint').textContent = t.initialAmountHint;
            document.getElementById('interestRateCompoundingLabel').textContent = t.interestRateCompounding;
            document.getElementById('interestRateCompoundingHint').textContent = t.interestRateCompoundingHint;
            document.getElementById('investmentTermLabel').textContent = t.investmentTerm;
            document.getElementById('investmentTermHint').textContent = t.investmentTermHint;
            document.getElementById('additionalInvestmentLabel').textContent = t.additionalInvestment;
            document.getElementById('additionalInvestmentHint').textContent = t.additionalInvestmentHint;
            document.getElementById('targetMonthlyIncomeLabel').textContent = t.targetMonthlyIncome;
            document.getElementById('targetMonthlyIncomeHint').textContent = t.targetMonthlyIncomeHint;
            document.getElementById('inflationRateLabel').textContent = t.inflationRate;
            document.getElementById('inflationRateHint').textContent = t.inflationRateHint;
            document.querySelector('.results-section .section__title').textContent = t.calculatedResults;
            document.querySelector('[id="finalAmountLabel"]').textContent = t.finalAmount;
            document.querySelector('[id="finalAmountHint"]').textContent = t.finalAmountHint;
            document.querySelector('[id="totalProfitLabel"]').textContent = t.totalProfit;
            document.querySelector('[id="totalProfitHint"]').textContent = t.totalProfitHint;
            document.querySelector('[id="effectiveRateLabel"]').textContent = t.effectiveRate;
            document.querySelector('[id="effectiveRateHint"]').textContent = t.effectiveRateHint;
            document.querySelector('[id="theoreticalMonthlyIncomeLabel"]').textContent = t.theoreticalMonthlyIncome;
            document.querySelector('[id="theoreticalMonthlyIncomeHint"]').textContent = t.theoreticalMonthlyIncomeHint;
            document.querySelector('[id="averageMonthlyProfitLabel"]').textContent = t.averageMonthlyProfit;
            document.querySelector('[id="averageMonthlyProfitHint"]').textContent = t.averageMonthlyProfitHint;
            document.querySelector('[id="averageAnnualProfitLabel"]').textContent = t.averageAnnualProfit;
            document.querySelector('[id="averageAnnualProfitHint"]').textContent = t.averageAnnualProfitHint;
            document.querySelector('.milestones-section .section__title').textContent = t.keyMilestones;
            document.getElementById('doubleLabel').textContent = t.doubleInvestment;
            document.getElementById('tenfoldLabel').textContent = t.tenfoldInvestment;
            document.getElementById('hundredfoldLabel').textContent = t.hundredfoldInvestment;
            document.getElementById('targetIncomeLabel').textContent = t.targetMonthlyIncomeMilestone;
            document.querySelector('.plan-section .section__title').textContent = t.monthlyIncomePlan;
            document.getElementById('monthLabel').textContent = t.month;
            document.getElementById('cumulativeAmountLabel').textContent = t.cumulativeAmount;
            document.getElementById('monthlyIncomeLabel').textContent = t.monthlyIncome;
            document.getElementById('monthlyPercentageLabel').textContent = t.monthlyPercentage;

            // Update validation tooltips
            translationElements.initialAmountValidationTooltip.textContent = t.initialAmount_tt;
            translationElements.interestRateValidationTooltip.textContent = t.interestRate_tt;
            translationElements.investmentTermValidationTooltip.textContent = t.investmentTerm_tt;
            translationElements.additionalAmountValidationTooltip.textContent = t.additionalAmount_tt;
            translationElements.targetMonthlyIncomeValidationTooltip.textContent = t.targetMonthlyIncome_tt;
            translationElements.inflationRateValidationTooltip.textContent = t.inflationRate_tt;

            // Update button text
            elements.languageToggle.textContent = currentLanguage === 'en' ? 'RU' : 'EN';
            elements.resetButton.dataset.tooltip = t.resetTooltip;
            const oppositeLang = currentLanguage === 'en' ? 'ru' : 'en';
            elements.languageToggle.dataset.tooltip = translations[oppositeLang].languageTooltip;
            elements.shareButton.dataset.tooltip = t.shareTooltip;
            updateThemeButton();

            // Reinitialize options
            initializeCompoundingOptions(selectedValues);
            
            // Recalculate values to update language-dependent text (e.g., milestones)
            updateCalculations();
        }

        // Event listeners
        elements.languageToggle.addEventListener('click', () => {
            currentLanguage = (currentLanguage === 'en') ? 'ru' : 'en';
            translateUI();
        });

        elements.themeToggleButton.addEventListener('click', () => {
            document.body.classList.toggle('dark-theme');
            updateThemeButton();
            saveState();
        });

        elements.shareButton.addEventListener('click', () => {
            const state = {
                ia: elements.initialAmount.value,
                ir: elements.interestRate.value,
                c: elements.compounding.value,
                it: elements.investmentTerm.value,
                tu: elements.termUnit.value,
                aa: elements.additionalAmount.value,
                af: elements.additionalFrequency.value,
                tmi: elements.targetMonthlyIncome.value,
                inf: elements.inflationRate.value,
                l: currentLanguage,
                th: document.body.classList.contains('dark-theme') ? '1' : '0'
            };
            const params = new URLSearchParams(state);
            const shareUrl = `${window.location.origin}${window.location.pathname}?${params.toString()}`;

            navigator.clipboard.writeText(shareUrl).then(() => {
                elements.shareButton.dataset.tooltip = translations[currentLanguage].copiedTooltip;
                setTimeout(() => { elements.shareButton.dataset.tooltip = translations[currentLanguage].shareTooltip; }, 2000);
            }).catch(err => console.error('Failed to copy URL: ', err));
        });

        elements.resetButton.addEventListener('click', () => {
            // Clear the saved state from storage to ensure a clean reset
            localStorage.removeItem(STORAGE_KEY);

            // Set default values
            elements.initialAmount.value = '10000';
            elements.interestRate.value = '8';
            elements.compounding.value = '365';
            elements.investmentTerm.value = '10';
            elements.termUnit.value = '365';
            elements.additionalAmount.value = '0';
            elements.additionalFrequency.value = '30';
            elements.targetMonthlyIncome.value = '1000';
            elements.inflationRate.value = '0';
            
            updateCalculations();
        });

        // Add event listeners to all input fields
        Object.values(elements).forEach(element => {
            if (element?.addEventListener) {
                element.addEventListener('input', updateCalculations);
            }
        });

        // Initialize after DOM is fully loaded to ensure correct element dimensions
        document.addEventListener('DOMContentLoaded', () => {
            loadInitialState();
            translateUI();
        });
    </script>
</body>
</html>